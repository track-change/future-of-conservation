---
import Recirculation from "@/components/Recirculation.astro";
import RootLayout from "@/layouts/RootLayout.astro";
import type { Page } from "@/sanity";
import { allPages, pageBySlugQuery } from "@/utils/queries";
import { astroI18n } from "astro-i18n";
import { sanityClient } from "sanity:client";
import { createGetStaticPaths } from "astro-i18n";
import { localizedQuery, slugsFor } from "@/queries/contentQueries";

export const getStaticPaths = createGetStaticPaths(slugsFor("page"));

const { locale, primaryLocale, route } = astroI18n;
const slug = route.replace("/", "");

const page = await localizedQuery<Page>(Astro)(pageBySlugQuery, {
  slug,
  locale,
  primaryLocale,
});
if (!page) {
  astroI18n.redirect("/404");
}
---

<RootLayout>
  {page && page.recirculation && <Recirculation recirc={page.recirculation} />}
</RootLayout>

<style></style>
