---
import { sanityClient } from "sanity:client";
import { siteNavQuery } from "../utils/queries";
import { type SiteNav } from "@/sanity";
import { resolveLinkURL, resolveReference } from "@/utils/resolveLinks";

interface Props {
  slug: string | undefined;
}

const { slug } = Astro.props;
const header = await sanityClient.fetch<SiteNav>(siteNavQuery);
---

<header>
  <h1><a href="/">Future of<br />Conservation</a></h1>
  <nav>
    {
      header.navHeaderTop && (
        <ul>
          {header.navHeaderTop.map((link) => {
            switch (link._type) {
              case "internalLink":
                const target = resolveReference(link.linkTarget);
                const href = resolveLinkURL(target);
                return (
                  <li>
                    <a
                      href={href}
                      aria-current={
                        href.startsWith(`/${slug}`) ? "page" : undefined
                      }
                    >
                      {target.title}
                    </a>
                  </li>
                );
              case "link":
                return (
                  <li>
                    <a
                      href={link.href}
                      target={link.blank ? "_blank" : undefined}
                      rel="noopener noreferrer"
                    >
                      {link.title || link.href}
                    </a>
                  </li>
                );
            }
          })}
        </ul>
      )
    }
  </nav>
</header>

<style>
  header {
    text-align: center;
  }
  h1 {
    font-size: min(12vw, 10rem);
    text-transform: uppercase;
    letter-spacing: -0.07em;
    line-height: 0.66;
    text-align: center;
    padding: 0.5em 0;
  }

  h1 a {
    width: min-content;
    margin: 0 auto;
  }

  nav {
    border-top: 1px solid var(--clr-fg);
    border-bottom: 1px solid var(--clr-fg);
    font-family:
      Helvetica Neue,
      Helvetica,
      Arial,
      sans-serif;
    text-transform: uppercase;
  }

  ul {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
  }

  li {
    flex: 1;
    min-width: 160px;
  }

  a {
    padding: 2px 10px;
    display: block;
    text-align: center;
    white-space: nowrap;
  }

  a[aria-current="page"] {
    background-color: var(--clr-3);
  }
</style>
